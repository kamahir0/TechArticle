# 序論
どうも！ AM3・クライアントエンジニアの平塚です。

時に、

皆さんのプロジェクトでは **デバッグ機能** どうされてますでしょうか？<br>
配属2カ月ちょいの新卒エンジニアは他PJの開発事情など当然のように知らないのですが、<br>
AM3ではこれまで**SRDebugger**というアセットでデバッグ機能を管理してきました。

アイテム付与やストーリー解放といったデバッグコマンドへのアクセスを提供する他、コンソールやプロファイラを実機でも確認可能にするなど、とっても便利な代物です。

しかし...やがてSRDebuggerに対して、ある不満がチーム内で浮かび上がってきました。<br>
それは **「デバッグコマンドが増えすぎてすごく見づらい！」** というものです。

![SRDebugger](https://raw.githubusercontent.com/kamahir0/TechArticle/master/UnityDebugSheetStart/IMG_7799.PNG)
ﾐﾁｨ...

ここまで多すぎると目当てのデバッグコマンドを見つけるのも一苦労ですね。
そこで、今回導入することになったのが**UnityDebugSheet**です。

![UnityDebugSheet](https://raw.githubusercontent.com/kamahir0/TechArticle/master/UnityDebugSheetStart/IMG_7800.PNG)

UnityDebugSheetはデバッグコマンドへのアクセスを階層式に格納するシステムを提供します。目当てのコマンドが見つけやすくなるので開発効率アップが期待できます。

今回の記事は、そんなUnityDebugSheetを新卒エンジニアが導入してみた！というお話です。

# 2つの概念
UnityDebugSheetを使う上で知っておくべき「セル」「ページ」という2つの概念があります。簡単にご説明しましょう。

## セル
デバッグシート上に配置される**ボタン**、**スイッチ**、**スライダー**といった各要素です。<br>
ボタンを押すことで何らかの処理を呼び出したり、スイッチやスライダーならbool・floatなどの値をここから取得することも可能です。また、完全オリジナルのセルを作ることもできます。

![cell](https://raw.githubusercontent.com/kamahir0/TechArticle/master/UnityDebugSheetStart/IMG_3791.PNG)

## ページ
セルの集合体であり、デバッグシートの階層の単位であり、常に1つ表示されています。
上述の「セル」の中には**ページリンクボタン**というボタンが用意されており、これを押すことでページから別のページへと進むことができます。<br>
また、デバッグシートの最も根本の階層部にあたるページは特別に**ルートページ**と呼ばれます。

![page](https://raw.githubusercontent.com/kamahir0/TechArticle/master/UnityDebugSheetStart/IMG_3790.PNG)

# 良い点・微妙な点
## 良い点
### アクセスしやすいデザイン
序論でも述べていますが、お目当ての機能にアクセスしやすいです。<br>
SRDebuggerは精々ボタンをやんわりグループ分けする程度しかできませんでしたが、UnityDebugSheetは階層式なので同じ画面中に並ぶボタンを絞れます。ﾐﾁｨ...なんて擬音とはオサラバです。<br>
またデバッグシートのセルには標準で、アイコンやサブテキストを付加する機能が用意されています。アイコンで分かりやすくできるのは勿論、サブテキストが意外に偉いです。

![SubText](https://raw.githubusercontent.com/kamahir0/TechArticle/master/UnityDebugSheetStart/IMG_7840.PNG)
 > サブテキストのおかげで、ページの中身がそれとなく推測できるようになっている

サブテキストに簡単な説明を併記しておくだけで、初見のデバッグコマンドの機能やページリンクボタンのリンク先ページの特色が、それを使わずとも推測できるようになります。<br>
これは持論ですが... **「それを使うとどうなるか」が使うまでもなく分かる** というのは、使い勝手を大きく左右するファクターだと私は思っています。

### ポップアップいらず
UnityDebugSheetにおいては、各ページクラスの`Initialize`関数の中に`Add〇〇`という関数群の呼び出しを書くことで、ページにセルが配置されるようになります。ここで、このAdd系関数はすべてint型のidを返します。<br>
ページクラスには`GetCell`関数なるものが用意されており、上述のidを使うことでセルの参照を得られる仕組みになっています。<br>
これが非常に強力で、ボタンによって実行する処理で動的にセルの状態を変化させたりすることを可能にします。

![増築ページ](https://raw.githubusercontent.com/kamahir0/TechArticle/master/UnityDebugSheetStart/IMG_7839.PNG)
 > 例) 浮島艦増築デバッグコマンド<br>
 >一番上のセルは文字列を表示するだけの機能を持つラベルセルで、その下がインプットフィールドセル。インプットフィールドにIDを入力すると、DBから対応した艦パーツのEntityを引っ張ってきてラベルを更新する仕組み。SRDebugger時代にこのような艦パーツ名を確認できる機能はなかった。

こういった凝ったデバッグ機能は従来であれば、専用ポップアップを作ってSRDebuggerにポップアップ呼び出しボタンを追加するような実装をしていたはずです。<br>
しかしUnityDebugSheetなら、ページクラス範囲内のコーディングだけで同等のものが作れます。AM3にも一応コーディングだけで作れる`DefaultPopup`といったものは存在しますが、自由度ではデバッグシートに軍配が上がるのではないでしょうか。

### スライドで開けるのが結構いい
SRDebuggerは画面の角のいずれかを選んで、そこを３回タップすると開くという仕組みでした。
一方UnityDebugSheetは同じような開き方に加えて、画面両端を縦にスライドすると開くという方式も併用できます。
iPhoneなんかは特に角丸なので、角のボタンはタップしづらかったりしますよね。その点デバッグシートは開きやすいです（多少は慣れが必要かもしれませんが）。

## 微妙な点
### リンクページボタンがオブジェクト指向的じゃない
先にちょろっと触れた、他のページへリンクする'ページリンクボタン'セルについて。
このボタン、通常のButtonセル同様にボタンテキスト・サブテキスト・アイコンなど設定できるのですが...
なんとそのままの仕様だと、これらの情報は**ページリンクボタンを配置する側が渡す**必要があります。
これが個人的には気に入らない点ですね。ページXにリンクするページリンクボタンを作成するなら、そのボタンに表示される文言やアイコンといった情報は**ページXクラスの定義**に置いておきたいところです。

### ピン留め機能がない
SRDebuggerには好きなボタンをピン留めして画面下部に常時表示させる機能がありますが、UnityDebugSheetにはそのような機能はありません。
人によってはあまり使う機会もないかもしれません。しかし少なくとも、AM3のインゲームをやるようになってからはこの機能とてもよく使うので、無いとちょっと困ります。

# 導入にあたり行った工夫
前項では色々とデバッグシートの微妙な点も挙げましたが、これらは導入するにあたっての工夫次第でカバーできるなと思いました。
ということで、ここでは私がとったアプローチを紹介したいと思います。
## AddPageLinkButton関数をシンプルに
UnityDebugSheetが用意するページリンクボタンへの不満は先に述べた通りです。
通常はページにページリンクボタンを追加する場合、

`AddPageLinlButton<TPage>(Text, SubText, icon, etc...);`

...のように関数を呼び出す必要があります。しかし、ページリンクボタンの情報くらいリンク先のクラスに持たせたい。
そのために今回は標準のページクラスを継承して、プロジェクト用の共通ベースクラスを作成しました。その名も`AM3DebugPage`。
で、`AddPageLinlButton`
